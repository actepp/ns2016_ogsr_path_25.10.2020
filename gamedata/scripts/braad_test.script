function false_info()
	local ln = level.name()
	local actor = db.actor
	if actor then
		if ln == "l06_rostok" and actor:has_info("zahar_naemnik_start") then
			actor:give_info_portion("zahar_naemnik_begin")
		elseif ln == "l10u_bunker" and actor:has_info("ucen_talk_need") then
			actor:give_info_portion("ucen_talk_spawn")
		elseif ln == "l01_escape" and actor:has_info("prizrak_finalzver_start") then
			actor:give_info_portion("info_spawn_zver")
		elseif actor:has_info('esc_snotvornoe_have') then
			actor:disable_info_portion('esc_snotvornoe_have')
		end
	end
end

function checking_use_item(obj)
	local ln = level.name()
	local actor = db.actor
	local sec = obj:section()
	-- записка Сыча
	if ln=="l10u_bunker" and sec=="sysh_document" then
		actor:give_info_portion("treasure_sysh_have")
		--amk.drop_item(actor,obj)
		--amk.remove_item(obj) 
	-- флешка Сыча
	elseif ln=="marsh" and sec=="sysh_flash" then actor:give_info_portion("treasure_sysh_start")
		amk.drop_item(actor,obj)
		amk.remove_item(obj)
		local items = {["ammo_gauss"] = 3, ["sysh_document"] = 1, ["antirad"] = 4, ["medkit_scientic"] = 2, ["af_kol_4"] = 1}
		local t_box = alife():object("sysh_treasure_box")
		if t_box then
		   local pos  = t_box.position
		   local lvid = t_box.m_level_vertex_id
		   local gvid = t_box.m_game_vertex_id
		   local id   = t_box.id
		   for k,v in pairs(items) do
		    for i = 1, v do
		     alife():create(k, pos, lvid, gvid, id)
		    end
		   end   
	end
	
	elseif ln=="l02_garbage" and sec=="pisma_stalka" then actor:give_info_portion("hog_start1")
		local items = {["detonator_2"] = 3, ["detonator"] = 2, ["bomba_mina_b"] = 2, ["bomba_mina_n"] = 3, ["bomba_small"] = 4, ["ammo_5.45x39_izomorf"] = 2, ["ammo_zhekan_izomorf"] = 2}
		local t_box = alife():object("gar_bulldozer_inventory_box")
		if t_box then
		   local pos  = t_box.position
		   local lvid = t_box.m_level_vertex_id
		   local gvid = t_box.m_game_vertex_id
		   local id   = t_box.id
		   for k,v in pairs(items) do
		    for i = 1, v do
		     alife():create(k, pos, lvid, gvid, id)
		    end
		   end   
	end
	
	
	elseif ln == "marsh" and sec == "mono_note" then
		local sim = alife()
		local tbl_targ = {"mar_neutral2","boloto_sniper1","mar_flesh1","mar_bibliotekar","marsh_zombi_hutor"}
		for i = 1, #tbl_targ do
			local sobj = sim:object(tbl_targ[i])
			if sobj then
				level.map_remove_object_spot(sobj.id,"crlc_big")
			end
		end
	-- записка пилота
	elseif ln=="l12_stancia_2" and sec=="pilot_zapiska" then actor:give_info_portion("pilot_zapiska_have")
	-- флешка Бивня
	elseif sec=="sniper_flash" then actor:give_info_portion("prizrak_zver_have") actor:give_info_portion("prizrak_finalzver_start")
                if kill_npc(9653) then
                  sol_utils.send_tip( "%c[255,160,160,160]".."СЫЧ:".."\\n".."%c[255,255,128,128] Прощайте, братцы, отвоева...", nil, nil, 20000)
				end    
	elseif ln=="l01_escape" and sec=="voen_document" then actor:give_info_portion("bandranen_pda_need") amk.drop_item(actor,obj) amk.remove_item(obj)
	elseif sec=="bandranen_pda" then actor:give_info_portion("bandranen_pda_est")
		amk.drop_item(actor,obj)
		amk.remove_item(obj)
		if amk_utils.inventory_search("fraer_pda",1) then
			actor:give_info_portion("prapor_talk_need")
			local prap = {"Меченый, приём. Будешь на Свалке - подходи, дело есть", "Меченый, это Прапор. Будешь на Свалке - подойди. Есть разговор"}
			local prap_levyi = {"А что у вас там за дела намечаются?", "Что за дела у вас намечаются, мужики?"}
			local prap_otver = {"Не твоё дело", "Тебя это не касается"}
			amk.send_tip("%c[255,255,100,128]"..prap[math.random(#prap)], "ПРАПОР", 30, 15, "common_channel")		
			amk.send_tip(prap_levyi[math.random(#prap_levyi)], "Пашка Винторез", 36, 15, "common_channel")	
			amk.send_tip(prap_otver[math.random(#prap_otver)], "Прапор", 42, 15, "common_channel")	
			local item = actor:object("fraer_pda")
			if item then
				amk.drop_item(actor,item)
				amk.remove_item(item)
			end
		end
	elseif sec=="fraer_pda" and actor:has_info("bandranen_pda_est") then actor:give_info_portion("prapor_talk_need")
			local prap = {"Меченый, приём. Будешь на Свалке - подходи, дело есть", "Меченый, это Прапор. Будешь на Свалке - подойди. Есть разговор"}
			local prap_levyi = {"А что у вас там за дела намечаются?", "Что за дела у вас намечаются, мужики?"}
			local prap_otver = {"Не твоё дело", "Тебя это не касается"}
			amk.send_tip("%c[255,255,100,128]"..prap[math.random(#prap)], "ПРАПОР", 30, 15, "common_channel")		
			amk.send_tip(prap_levyi[math.random(#prap_levyi)], "Пашка Винторез", 36, 15, "common_channel")	
			amk.send_tip(prap_otver[math.random(#prap_otver)], "Прапор", 42, 15, "common_channel")	
	amk.drop_item(actor,obj) amk.remove_item(obj)
	elseif ln=="l07_military" and sec=="ara_pda" then actor:give_info_portion("ara_pda_est") amk.drop_item(actor,obj) amk.remove_item(obj)
	elseif ln=="l08_yantar" and sec=="zapiska_ranennogo"  then actor:give_info_portion("have_listok")
			amk.drop_item(actor,obj)
			amk.remove_item(obj)
	elseif ln=="l10_radar" and sec=="sak_document"  then
			actor:give_info_portion("have_sak_document")
			amk.drop_item(actor,obj)
			amk.remove_item(obj)
	elseif ln=="l03_agroprom" and sec=="amk_zapiska" then
			actor:give_info_portion("have_amk_zapiska")
			amk.drop_item(actor,obj)
			amk.remove_item(obj)
	elseif ln=="l10_radar" and sec=="rad_document6" then
			actor:give_info_portion("have_rad_document6")
			amk.drop_item(actor,obj)
			amk.remove_item(obj)

	elseif ln=="l03u_agr_underground" and sec=="gunslinger_flash" then
			amk.drop_item(actor,obj)
			amk.remove_item(obj)
			
	elseif sec=="decoder" and actor:has_info("sar_finish_decoding") 
	then actor:give_info_portion("nakonez_to") 
	amk.drop_item(actor,obj) 
	amk.remove_item(obj)
			
	elseif ln=="lost_village" and sec=="kapitan_pda" and actor:dont_has_info("pda_bazar") then
		actor:give_info_portion("pda_bazar")
                amk.g_start_timer("village_kap_pda", 0, 0, 1)
	elseif ln=="generators" and sec=="dosye_zvez"  then actor:give_info_portion("idu_na_nz")
	elseif ln=="atp_for_test22" and sec=="disk_adren"  then actor:give_info_portion("atp_banda_disk_spawn")
	elseif sec=="razved_karta" then
			actor:give_info_portion("otkput_march_perexod")
			amk.drop_item(actor,obj)
			amk.remove_item(obj)
	elseif sec=="psewdoportator" then actor:give_info_portion("sosolov_pribor_have")
	elseif sec=="recipi_bpb" then actor:give_info_portion("info_artmod_probabka_burera")
			amk.drop_item(actor,obj)
			amk.remove_item(obj)
	elseif sec=="stukach_book" then 
			actor:give_info_portion("info_artmod_cristall_buzz")
			amk.drop_item(actor,obj)
			amk.remove_item(obj)
	elseif sec=="arhara_listok" then actor:give_info_portion("perehod_chaes2_na_chaes") actor:give_info_portion("strelok_pda2_done") actor:give_info_portion("strelok_pda_start2")
	elseif sec=="bloknot_pantera" then actor:give_info_portion("perehod_warlab_na_gener")
	elseif sec=="kod_listok" then actor:give_info_portion("jupiter_kod_have")
	elseif sec=="pult_cod" then actor:give_info_portion("pult_kod_have")
	amk.drop_item(actor,obj)
	amk.remove_item(obj)
	elseif sec=="new_document_sniper" then actor:give_info_portion("rebyta_domoy")
	elseif sec=="forest_last_dead_listok" then actor:give_info_portion("forest_psu_perex")
	elseif sec=="klenov_opisalovo" then actor:give_info_portion("posulku_poluchil")
	elseif sec=="korobka_sigars" then actor:give_info_portion("portal_lima_idu")
	elseif sec=="af_kristal_izomorf" then actor:give_info_portion("superzhekan_est") amk.drop_item(actor,obj) amk.remove_item(obj)
	elseif sec=="let_ostrov" then actor:give_info_portion("spawn_stalki_zasada")
	elseif sec=="iskra_listok" then actor:give_info_portion("tel_dcity_kanaliy")
	elseif sec=="zaton_karta_boloto" then actor:give_info_portion("zaton_put_gruppu")
	elseif sec=="shaxter_konteyner" then actor:give_info_portion("krovosos_peshera_spawn3")
	elseif sec=="mem_module" then actor:give_info_portion("perexody_otkryty") amk.drop_item(actor,obj) amk.remove_item(obj)
	elseif sec=="tranzistory" then actor:give_info_portion("tranzistory_es")
	elseif sec=="plato_bloknot" then actor:give_info_portion("elza_dopros") arhara_dialog.elza_vstrecha()
	elseif sec=="notebook_zlobnyi" then actor:give_info_portion("mg_kod_have")
	elseif sec=="af_545x39_izomorf" then amk.drop_item(actor,obj) amk.remove_item(obj) 
	elseif sec=="af_762x54_izomorf" then amk.drop_item(actor,obj) amk.remove_item(obj)
	elseif sec=="af_zhekan_izomorf" then amk.drop_item(actor,obj) amk.remove_item(obj)
	elseif sec=="af_9x39_izomorf" and actor:has_info("kod_vveden_verno") then actor:give_info_portion("dell_blok_tele") amk.drop_item(actor,obj) amk.remove_item(obj)
	elseif sec=="siv_pda" and actor:has_info("ara_pda_est") then actor:give_info_portion("sah_talk_need") amk.drop_item(actor,obj) amk.remove_item(obj)
    elseif sec=="kalugin_bloknot" then actor:give_info_portion("spavn_semenih")
	amk.drop_item(actor,obj)
	amk.remove_item(obj)
    elseif sec=="semenih_bloknot" then actor:give_info_portion("spavn_tainiki")
	amk.drop_item(actor,obj)
	amk.remove_item(obj)
    elseif sec=="bolt_pda" and not actor:has_info("bolt_pda_start") then actor:give_info_portion("bolt_pda_start") spawn_zombi.sms_dos()
    elseif sec=="kod_flash" then actor:give_info_portion("cod_1")
	amk.drop_item(actor,obj)
	amk.remove_item(obj)
    elseif sec=="kod_flash2" then actor:give_info_portion("cod_2")
	amk.drop_item(actor,obj)
	amk.remove_item(obj)
	elseif sec=="urt_flash" then actor:give_info_portion("urt_flash_have")
    elseif sec=="info_listok" then actor:give_info_portion("open_perehod_aes")
	elseif sec=="karta_gavr" then actor:give_info_portion("karta_gavr_est")
		amk.drop_item(actor,obj)
		amk.remove_item(obj)
	elseif sec=="doberman_pda" then actor:give_info_portion("doberman_pda_est")
	elseif sec=="pda_voyak" then actor:give_info_portion("pda_voyak_est")
	elseif ln=="l12_stancia_2" and sec=="aes_document" then actor:give_info_portion("poisk_taynik_voyak_finish")
	elseif sec=="borov_listok" then actor:give_info_portion("borov_listok_est")
		amk.drop_item(actor,obj)
		amk.remove_item(obj)
	elseif sec=="trup_listok" then actor:give_info_portion("trup_listok_est")
		amk.drop_item(actor,obj)
		amk.remove_item(obj)
	elseif sec=="mirror_listok" then actor:give_info_portion("mirror_listok_est")
		amk.drop_item(actor,obj)
		amk.remove_item(obj)
	elseif sec=="bar_listok" then actor:give_info_portion("bar_listok_est")
		amk.drop_item(actor,obj)
		amk.remove_item(obj)
		
	elseif sec=="pda_krysyka" then
		actor:give_info_portion("info_artmod_vyvert_buzz")
		actor:give_info_portion("info_borov_kod")
		amk.drop_item(actor,obj)
		amk.remove_item(obj)
	elseif sec == "af_caterpillar" and not actor:has_info("bezoar_nashel") then
		actor:give_info_portion("bezoar_nashel")
	elseif sec=="inventory_sakbox_011" then actor:give_info_portion("val_pula_ammo_done1")
	elseif ln=="jupiter_underground" and sec == "wpn_fn2000_sniper" and not actor:has_info("evil_piano_start") then
		actor:give_info_portion("evil_piano_start")
    elseif sec=="doki_monolit" then actor:give_info_portion("doki_monolit_est")
    elseif sec=="doki_fritz" then actor:give_info_portion("doki_fritz_est")
	elseif ln=="atp_for_test22" and sec == "gonets_flash" and not actor:has_info("gonets_spasti_have") then
		actor:give_info_portion("gonets_spasti_have")
	elseif ln=="av_peshera" and sec == "kod_kamera" and not actor:has_info("shax_plennik_nayti_have") then
		actor:give_info_portion("shax_plennik_nayti_have")			
	elseif ln=="av_peshera" and sec == "shkatulka" and not actor:has_info("adr_shkatulka_dost_have") then
		actor:give_info_portion("adr_shkatulka_dost_have")
	elseif ln=="av_peshera" and sec == "avu_door_cod" and not actor:has_info("adr_door_cod_have") then
		actor:give_info_portion("adr_door_cod_have")
		amk.drop_item(actor,obj)
		amk.remove_item(obj)
	elseif ln=="av_peshera" and sec == "arhara_seif" and not actor:has_info("adr_arhara_seif_have") then
		actor:give_info_portion("adr_arhara_seif_have")
	elseif ln=="av_peshera" and sec == "amul_naemn" and not actor:has_info("lukash_pechatka_nayti_have") then
		actor:give_info_portion("lukash_pechatka_nayti_have")
	elseif ln=="warlab" and sec == "naem_bloknot" and not actor:has_info("kluk_vstrecha_have") then
		actor:give_info_portion("kluk_vstrecha_have")
	elseif ln=="l07_military" and sec=="vodka"  then actor:give_info_portion("joker_bazar")
	end
end

function dead_npc()
  
  local actor = db.actor
  	if	(has_alife_info("esc_saha_dead") or
		has_alife_info("dyak_dead")) and not
		has_alife_info("dyak_help_done") then
			actor:give_info_portion("dyak_help_fail")
	elseif (has_alife_info("add_church_ban1_dead") or
		has_alife_info("add_church_ban2_dead") or
        has_alife_info("add_church_ban3_dead")) then
			actor:give_info_portion("add_church_ban_signal") 
	end
	if (has_alife_info("chuk_dead")	or has_alife_info("gek_dead")) and not has_alife_info("kot_agro_mono_have") then
		actor:give_info_portion("kot_agro_mono_fail")
    end
end

function marsh_first_spawn()
	local actor = db.actor
	if not actor:has_info("marsh_band_spawn") then
		local sim = alife()
		local vec = vector()
		local spn_targ = {
			["agr_bandit_respawn_1"]	= {299.289,0.59365,-122.695,331636,3531},
			["agr_bandit_respawn_2"]	= {299.289,0.59365,-122.695,331636,3531},
			["gar_bandit_respawn_2"]	= {299.289,0.59365,-122.695,331636,3531},
			["ds_bandit_respawn_2"]		= {299.289,0.59365,-122.695,331636,3531},
			["ds_bandit_respawn_3"]		= {252.754,0.3090138,-145.589,296792,3510},
			["val_bandit_respawn_4"]	= {252.754,0.3090138,-145.589,296792,3510},
			["val_bandit_respawn_4"]	= {252.754,0.3090138,-145.589,296792,3510},
			["val_bandit_respawn_4"]	= {252.754,0.3090138,-145.589,296792,3510},
			["marsh_nebo_ambush1"]		= {37.800182342,1.1534446,-201.8684,158865,3442},
			["marsh_nebo_ambush2"]		= {37.800182342,1.1534446,-201.8684,158865,3442},
			["marsh_nebo_ambush3"]		= {37.800182342,1.1534446,-201.8684,158865,3442},
			["marsh_nebo_ambush1"]		= {37.800182342,1.1534446,-201.8684,158865,3442},
			["prov_ruk"]				= {-3.481797,3.3647267818451,12.3242,137219,3418}
		}
		for k,v in pairs(spn_targ) do
			sim:create(k,vec:set(v[1],v[2],v[3]),v[4],v[5])
		end
		actor:give_info_portion("marsh_band_spawn")
		spawn_prohod_lim()
		spawn_prohod_hos()       
	end
end

function check_info()
	local ln = level.name()
	local actor = db.actor
	if actor then
		if has_alife_info("brat_luis_have") and not has_alife_info("brat_luis_killself") then
			amk.start_timer("luis_killself",math.random(10,15))
			actor:give_info_portion("brat_luis_killself")
		elseif has_alife_info("skarabey_one_ok") and not has_alife_info("spawn_zaton_amerika") then
			actor:give_info_portion("zaton_amerika_find")
		elseif ln == "marsh" and actor:has_info("brat_luis_start") then
			actor:give_info_portion("brat_luis_spawn")
		elseif ln == "l07_military" and actor:has_info("francuz_start") then
			actor:give_info_portion("francuz_spawn")
		elseif ln == "dead_city" and actor:has_info("iskra_say_one_start") and actor:has_info("gulden_goodbay_one_start") then
			actor:give_info_portion("zat_gulden_uletel")
		elseif ln == "l03_agroprom" and actor:has_info("kot_agro_mono_start") and not has_alife_info("kot_agro_mono_spawn") then
			actor:give_info_portion("kot_agro_mono_spawn")
			
		elseif ln == "l05_bar" and not has_alife_info("door_cod_est") then
			if actor:has_info("cod_1") and actor:has_info("cod_2") and actor:has_info("bolt_pda_done") then
				actor:give_info_portion("door_cod_est")
			end
		
		elseif ln == "atp_for_test22" and not has_alife_info("door_cod_est") then
			if actor:has_info("cod_1") and actor:has_info("cod_2") and actor:has_info("bolt_pda_done") then
				actor:give_info_portion("door_cod_est")
			end
			
		elseif ln == "l10u_bunker" and not has_alife_info("door_cod_est") then
			if actor:has_info("cod_1") and actor:has_info("cod_2") and actor:has_info("bolt_pda_done") then
				actor:give_info_portion("door_cod_est")
			end
			
		elseif ln == "limansk" and not has_alife_info("borman_sniper_have") then
			if actor:has_info("borman_sniper_death1") and actor:has_info("borman_sniper_death2") then
				actor:give_info_portion("borman_sniper_have")
			end
		elseif has_alife_info("yan_yazva_hit") and has_alife_info("x18_mozg_hit") and not has_alife_info("izomorf_dialog_have") then
			actor:give_info_portion("izomorf_dialog_have")
		end
	end
end

function new_info()
	local ln = level.name()
	local actor = db.actor

	if ln == "marsh" and (has_alife_info("xalyava_dead")) and not has_alife_info("xalyava_nebo_have") then
		actor:give_info_portion("xalyava_nebo_fail")
	end
end

function main_friend(npc)
	sol_utils.setRelation(npc, game_object.friend, db.actor)
end

function zombie_blow()
	local sim = alife()
	local v = vector()
	sim:create("burer_strong",v:set(-108.363,21.564,-35.483),312,1529)
	sim:create("burer_strong",v:set(-108.363,21.564,-35.483),312,1529)
	sim:create("bloodsucker_sky",v:set(-146.986,-19.088,-72.524),1082,1457)
	sim:create("cat_strong",v:set(-85.379,-19.090,-49.233),9988,1495)
	sim:create("cat_strong",v:set(-85.379,-19.090,-49.233),9988,1495)
	sim:create("cat_strong",v:set(-85.379,-19.090,-49.233),9988,1495)
	sim:create("cat_strong",v:set(-85.379,-19.090,-49.233),9988,1495)
	sim:create("cat_strong",v:set(-86.602,-19.090,-171.465),9340,1455)
	sim:create("cat_strong",v:set(-86.602,-19.090,-171.465),9340,1455)
end

function radar_man()
	local sim = alife()
	local v = vector()
	sim:create("controller_strong",v:set(-61.979244232178,-21.8962020874,35.8896102905),195,2727)
	sim:create("controller_strong",v:set(0.86928582191467,-23.69577599,1.777916193),6155,2703)
	sim:create("zombie_babka_normal",v:set(0.86928582191467,-23.69577599,1.777916193),6155,2703)
	sim:create("zombie_babka_strong",v:set(0.86928582191467,-23.69577599,1.777916193),6155,2703)
	sim:create("zombie_normal",v:set(0.86928582191467,-23.69577599,1.777916193),6155,2703)
	sim:create("zombie_normal",v:set(0.86928582191467,-23.69577599,1.777916193),6155,2703)
	sim:create("zombie_normal",v:set(0.86928582191467,-23.69577599,1.777916193),6155,2703)
	sim:create("zombie_normal",v:set(0.86928582191467,-23.69577599,1.777916193),6155,2703)
	sim:create("zombie_blow",v:set(0.86928582191467,-23.69577599,1.777916193),6155,2703)
	sim:create("zombie_normal",v:set(0.86928582191467,-23.69577599,1.777916193),6155,2703)
end

-- гавр становится врагом
function killactor (sid)
	local sidEnemy = {9623, 9624, 9625, 9905}
	local npc
	for i = 1, #sidEnemy do
		npc = level_object_by_sid (sidEnemy[i])
    	if npc and npc:alive() then
			sol_utils.setRelation(npc, game_object.enemy, db.actor)
    	end    	
	end
end

function killactor_spawn()
	local sim = alife()
	local v = vector()
	sim:create("killer_boevik2",v:set(43.09783554,-8.13079166,14.410468),345215,1582)
	sim:create("killer_boevik1",v:set(59.50757599,-8.5839643,9.3478708),358211,1570)
	sim:create("killer_boevik3",v:set(59.52076721,-8.7670116,22.850177765),358227,1559)
	sim:create("killer_boevik4",v:set(40.780555725,-8.319325447,19.2897949),343015,1582)
	sim:create("killer_boevik5",v:set(46.9849434,-8.1420059,20.492004),348191,1582)
	sim:create("killer_boevik6",v:set(51.40478897,-8.08700466,13.5054283),351374,1582)
end

function sorok_pda()
	return new_dialog.item_much("device_pda_npc",40) ~= false
end
   
   
function sorok_pda_sdal(first_speaker, second_speaker)
new_dialog.out_item_much("device_pda_npc",40) 
end

function chern_dogs()
	local sim = alife()
	local v = vector()
	sim:create("psy_dog_strong",v:set(338.74279785,-46.47824478,-163.8179168),86443,2086)
	sim:create("psy_dog_strong",v:set(338.74279785,-46.47824478,-163.8179168),86443,2086)
	sim:create("psy_dog_strong",v:set(354.486083984,-45.66619491577,-213.2041015625),95066,1872)
	sim:create("psy_dog_strong",v:set(354.486083984,-45.66619491577,-213.2041015625),95066,1872)
end

function kill_npc(sid)
 local npc = level_object_by_sid(sid)
 if npc and npc:alive() then npc:kill(npc) return true end    
 return false
end

function kill_npc_by_name(npcname)
 local level_object_by_id = level.object_by_id
 local k, v, npc
 for k, v in pairs(db.storage) do
  npc = level_object_by_id(k)
  if npc and npc:alive() and npc:name()==npcname then
   npc:kill(npc)
   return true
  end
 end
 return false
end


function take_yakut_agro2_spot()
	sak.add_spot_of_docent(9650)
end


function new_comp()
	alife():create("computer_new",vector():set(27.945556640625,-6.619695186615,-14.894629478455),6746,1140)
end

function release_actor_items()
    local obj
    local sim = alife()
    local actor = db.actor
	local scale = amk.load_variable("gg_need_sleep_nrg",0)
	local box = level_object_by_sid(5227); -- ящик за Гавром
	if box then
		--sim:set_switch_offline (box:id(), false)
		--sim:set_switch_online  (box:id(), true)
		-- перебор вещей инвентаря
		local cnt = actor:object_count()
		for i=0, cnt-1 do
			obj = actor:object(i)
	-- унифицируем процедуру. Исключения items_protected - в скрипте protected_items.script.
	-- Имя секции объекта определяем уже там. Имя таблицы - второй параметр.
			if protected_items.doNotTouchItem(obj) == false then
				-- удаление вещи

				if protected_items.doNotTouchAnything(obj) then
					get_console():execute("load ~~~ release_actor_items transfer_item: "..obj:name())
					actor:transfer_item(obj, box)
				else
					get_console():execute("load ~~~ release_actor_items release: "..obj:name())
					sim:release(sim:object(obj:id()), true)
				end

				scale = 5 + scale
			end
			sleep_manager.main(5+amk.load_variable("gg_need_sleep_nrg",0))
		end
	end
end	

function release_actor_money()
  local num = db.actor:money() 
  db.actor:give_money(-num)
  game_stats.money_quest_update(-num) 
end

function friendactor(community1, community2)
relation_registry.set_community_goodwill ("stalker", "actor", 2000)
sol_utils.minimapSpotReset()
end


function zahar_naemnik_have(task, info)
	local actor = db.actor
  if actor and actor:has_info("naem_zahar1_dead") and
	actor:has_info("naem_zahar2_dead") and
	actor:has_info("naem_zahar3_dead") and
	actor:has_info("naem_zahar4_dead") and
	actor:has_info("naem_zahar5_dead") and
	actor:has_info("naem_zahar6_dead") ~= nil then
		return actor:give_info_portion("zahar_naemnik_have") ~= nil   
  end
return false
end

function check_ecolog_dead()
	local rnd = math.random
	local actor = db.actor
    if actor and actor:has_info("ucen_talk_est") and not
		actor:has_info("marsh_dan_umer_newsinfo4") then
--                amk.start_timer("sms_new1",rnd(140,170))
               actor:give_info_portion("marsh_dan_umer_newsinfo4")
	end		
end

function sms_new1()
    db.actor:give_info_portion("sms_new_dan2")
--  amk.send_tip(game.translate_string("sms_new_dan2_text"),nil,nil,30)
end

function delete_smart()
  local se_obj = alife():object("esc2_bloodsucker1")
  if se_obj then
    alife():release(se_obj, true)
  end
end

function spawn_church_band()
	local sim = alife()
	local v = vector()
	sim:create("add_church_ban1",v:set(294.5813,7.1353683,-153.27551),327543,3531)
	sim:create("add_church_ban2",v:set(294.5813,7.1353683,-153.27551),327543,3531)
	sim:create("add_church_ban3",v:set(294.5813,7.1353683,-153.27551),327543,3531)
end

function remove_village()
	local sim = alife()
	local obj = sim:object("marsh_small_nebo")
	if obj then
		level.map_remove_object_spot(obj.id,"blue_location")
	end
end

function sed_dyak()
	local sim = alife()
	local obj = sim:object("dyak")
	if obj then
		amk.add_spot_on_map(obj.id,"blue_location","Дьяк") 
	end
end

function remove_dyak()
	local sim = alife()
	local obj = sim:object("dyak")
	if obj then
		level.map_remove_object_spot(obj.id,"blue_location")
	end
end

function mina_band()
	local actor = db.actor
	local actor_pos = actor:position()
	local sim = alife()
	local dist,id,item,obj,obj_pos,sobj
	for i=1, 65534 do
		obj = level.object_by_id(i)
		if obj and obj:section() == "prov_ruk" then
			actor:give_info_portion("kalmyak_vstreca_start")
			obj_pos = obj:position()
			dist = actor_pos:distance_to(obj_pos)
			sobj = sim:object(obj:id())
			amk_particle.amk_particle({particle="explosions\\explosion_fuelcan",pos=obj_pos,sound=[[weapons\t_rgd5_explosion]]})
	        	if dist < 10 then	
				local h = hit()
				h.draftsman = actor
				h.direction = vector():set(0,0,0)
				h:bone("bip01_spine")
				h.type = hit.explosion
				h.power = 0.8
				h.impulse = 500
				actor:hit(h)
			end
			-- нельзя удалять рюкзак с открытым окном шмона
			if obj:is_inv_box_empty() then
				level.start_stop_menu(level.main_input_receiver(),true)
				level.add_pp_effector("amk_shoot.ppe", 2011, false)
				if sobj then
					sim:release(sobj)
				end
				item = actor:object("grenade_rgd5_new")
				id = item and (item:id() or item.id)
				sobj = id and sim:object(id)
				if sobj then
					sim:release(sobj)
				end
				return
			end
		end
	end
end

----------
-- чтение формы из нет-пакета
----------
function r_shape(packet)
	local s
	local st = {}
	st.count = packet:r_u8()
	st.shapes = {}
	for i=1, st.count do
		s = {}
		s.type = packet:r_u8()
		if s.type == 0 then
			s.center = packet:r_vec3()
			s.radius = packet:r_float()
		else
			s.axis_x = packet:r_vec3()
			s.axis_y = packet:r_vec3()
			s.axis_z = packet:r_vec3()
			s.offset = packet:r_vec3()
		end
		st.shapes[i] = s
	end
	return st
end

----------
-- запись формы в нет-пакет
----------
function w_shape(packet, st)
	local s
	packet:w_u8(st.count)
	for i=1, st.count do
		s = st.shapes[i]
		packet:w_u8(s.type)
		if s.type == 0 then
			packet:w_vec3(s.center)
			packet:w_float(s.radius)
		else
			packet:w_vec3(s.axis_x)
			packet:w_vec3(s.axis_y)
			packet:w_vec3(s.axis_z)
			packet:w_vec3(s.offset)
		end
	end
end

----------
-- перепаковка нет-пакета созданного скриптом рестрикта
----------
function rewrite_restrictor(se_obj, custom, radius)
	local packet = net_packet()
	se_obj:STATE_Write(packet)
	local game_vertex_id	= packet:r_u16()
	local distance		= packet:r_float()
	local direct_control	= packet:r_s32()
	local level_vertex_id	= packet:r_s32()
	local object_flags		= packet:r_s32()
	local custom_data		= packet:r_stringZ()
	local story_id		= packet:r_s32()
	local spawn_story_id	= packet:r_s32()
	local shape		= r_shape(packet)
	local restrictor_type	= packet:r_u8()

	custom_data = custom
	shape = {}
	shape.count = 1
	shape.shapes = {}
	shape.shapes[1] = {}
	shape.shapes[1].type = 0
	shape.shapes[1].center = vector():set(0,0,0)
	shape.shapes[1].radius = radius

	packet:w_u16(game_vertex_id)
	packet:w_float(distance)
	packet:w_s32(direct_control)
	packet:w_s32(level_vertex_id)
	packet:w_s32(object_flags)
	packet:w_stringZ(custom_data)
	packet:w_s32(story_id)
	packet:w_s32(spawn_story_id)
	w_shape(packet, shape)
	packet:w_u8(restrictor_type)
	se_obj:STATE_Read(packet, packet:w_tell() - packet:r_tell())
end

function kalmyak_tele()
	local actor = db.actor
	level.add_pp_effector("blink.ppe",234,false)
	level.add_pp_effector("teleport.ppe",2006,false)
	actor:set_actor_position(patrol("kalmyak_tele_walk"):point(0))
	local dir = patrol("kalmyak_tele_look"):point(0):sub(patrol("kalmyak_tele_look"):point(0))
	actor:set_actor_direction(-dir:getH())
end
------------------------------ НЕ ИСПОЛЬЗУЕТСЯ!!!!!!!!!!
function delete_obj_restrictor()
  local se_obj = alife():object("marsh_havan_restr")
  if se_obj then
    alife():release(se_obj, true)
  end
end

function spawn_havan_restr2()
local se_obj = alife():create("space_restrictor",vector():set(-4.2143630981445,3.3634412288666,12.2967),136894,3418)
local custom = "[logic]\ncfg = scripts\\new\\nebo\\marsh_havan_restr2.ltx"
rewrite_restrictor(se_obj, custom, 3.0)
end

local out_object
local in_object

function ograblen_kalm(actor,npc)
local inv_box_1 = level_object_by_sid(14003)
out_object = db.actor
in_object = inv_box_1
db.actor:inventory_for_each(transfer_object_item)
end

function vozvrat_kalm(actor,npc)
local inv_box_1 = level_object_by_sid(14003)
in_object = db.actor
out_object = inv_box_1
out_object:inventory_for_each(transfer_object_item)
end

function transfer_object_item(item)
out_object:transfer_item(item, in_object)
end 
------------------------------ НЕ ИСПОЛЬЗУЕТСЯ!!!!!!!!!!
function kalmyak_vrag(actor, npc)
    xr_gulag.setGulagEnemy ("kalmyak_marsh", actor)
end

function kalmyak_spawn()
local obj = alife():create("kalmyak_ruk",vector():set(-199.24903869629,0.60609865188599,130.58129),38203,3383)
   create_kalmyak_restr()
   set_kalmyak_ruk()
end

function create_kalmyak_restr()
	local sim = alife()
	local v = vector()
	local se_obj = sim:create("space_restrictor",v:set(-194.6745300293,0.58615601062775,133.2268),38203,3383)
	local custom = "[logic]\ncfg = scripts\\new\\nebo\\kalmyak_restr1.ltx"
	rewrite_restrictor(se_obj, custom, 3.0)
	local se_obj = sim:create("space_restrictor",v:set(-190.16891479492,-0.44136956334114,125.738),38203,3383)
	local custom = "[logic]\ncfg = scripts\\new\\nebo\\kalmyak_restr2.ltx"
	rewrite_restrictor(se_obj, custom, 3.0)
	local se_obj = sim:create("space_restrictor",v:set(-192.65054321289,-0.32059952616692,119.033),38203,3383)
	local custom = "[logic]\ncfg = scripts\\new\\nebo\\kalmyak_restr3.ltx"
	rewrite_restrictor(se_obj, custom, 3.0)
	local se_obj = sim:create("space_restrictor",v:set(-201.21597290039,0.26242354512215,116.694),38203,3383)
	local custom = "[logic]\ncfg = scripts\\new\\nebo\\kalmyak_restr4.ltx"
	rewrite_restrictor(se_obj, custom, 3.0)
	local se_obj = sim:create("space_restrictor",v:set(-206.72094726563,-0.32424575090408,123.919),37907,3383)
	local custom = "[logic]\ncfg = scripts\\new\\nebo\\kalmyak_restr5.ltx"
	rewrite_restrictor(se_obj, custom, 3.0)
	local se_obj = sim:create("space_restrictor",v:set(-203.21374511719,-0.32538011670113,137.027),37907,3383)
	local custom = "[logic]\ncfg = scripts\\new\\nebo\\kalmyak_restr6.ltx"
	rewrite_restrictor(se_obj, custom, 3.0)
end


function set_kalmyak_ruk()
	local sim = alife()
for a=1,65534 do
    local obj = sim:object(a) 
       if obj then
          if obj:section_name() == "box_kalmyak" then 
            amk.add_spot_on_map(obj.id,"crlc_big","Рюкзак Калмыка") 
			break
		  end
       end
   end
end

function remove_kalmyak_ruk()
local sim = alife()
for a=1,65534 do
  local obj = sim:object(a)
      if obj then
        if obj:section_name() == "box_kalmyak" then 
           level.map_remove_object_spot(obj.id,"crlc_big")
        break
        end
      end
   end
end

function set_kalmyak()
	local sim = alife()
	local obj = sim:object("kalmyak_marsh")
	if obj then
		amk.add_spot_on_map(obj.id,"crlc_big","Предположительное местонахождение Калмыка")
	end
end

function remove_kalmyak()
	local sim = alife()
	local obj = sim:object("kalmyak_marsh")
	if obj then
		level.map_remove_object_spot(obj.id,"crlc_big")
	end
end

------НЕ ЗАБУДЬ!!!!!!!!!!!!!! ДОБАВИТЬ ФАЙЛЫ ЛОГИКИ
function kontr_marsh_restr()
	local sim = alife()
	local v = vector()
	local custom,se_obj
	se_obj = sim:create("space_restrictor",v:set(-171.56242370605,0.78741002082825,391.19),56846,3371)
	custom = "[logic]\ncfg = scripts\\new\\nebo\\kontr_marsh_restr1.ltx"
	rewrite_restrictor(se_obj, custom, 53.0)
	se_obj = sim:create("space_restrictor",v:set(-170.94248962402,1.1991214752197,404.29232),57320,3361)
	custom = "[logic]\ncfg = scripts\\new\\nebo\\kontr_marsh_restr2.ltx"
	rewrite_restrictor(se_obj, custom, 53.0)
	se_obj = sim:create("space_restrictor",v:set(-192.83070373535,1.0270764827728,396.1445),45298,3361)
	custom = "[logic]\ncfg = scripts\\new\\nebo\\kontr_marsh_restr3.ltx"
	rewrite_restrictor(se_obj, custom, 53.0)
	se_obj = sim:create("space_restrictor",v:set(-204.17848205566,0.53202784061432,404.1797),39196,3361)
	custom = "[logic]\ncfg = scripts\\new\\nebo\\kontr_marsh_restr4.ltx"
	rewrite_restrictor(se_obj, custom, 53.0)
	se_obj = sim:create("space_restrictor",v:set(-189.07986450195,1.2418839931488,418.6262),46761,3361)
	custom = "[logic]\ncfg = scripts\\new\\nebo\\kontr_marsh_restr5.ltx"
	rewrite_restrictor(se_obj, custom, 53.0)
	se_obj = sim:create("space_restrictor",v:set(-175.13674926758,1.3927493095398,423.0242),54657,3361)
	custom = "[logic]\ncfg = scripts\\new\\nebo\\kontr_marsh_restr6.ltx"
	rewrite_restrictor(se_obj, custom, 53.0)
end
------НЕ ЗАБУДЬ!!!!!!!!!!!!!! ДОБАВИТЬ ФАЙЛЫ ЛОГИКИ

function set_red_contr()
local sim = alife()
for a=1,65534 do
   local obj = sim:object(a) 
       if obj then
          if obj and obj:name() == "mar_controller3" then 
            amk.add_spot_on_map(obj.id,"crlc_big","Предположительное местонахождение контролера") 
		  end
       end
   end
end

function remove_red_contr()
local sim = alife()
for a=1,65534 do
   local obj = sim:object(a) 
      if obj then
        if obj and obj:name() == "mar_controller3" then 
           level.map_remove_object_spot(obj.id,"crlc_big")
        break
        end
      end
   end
end

function kashei_spawn()
 alife():create("sveeblov_ruk",vector():set(406.22711181641,3.4233021736145,236.834),407402,3546)
end
function set_kashei()
	local obj = alife():object("kashei")
	if obj then
		amk.add_spot_on_map(obj.id,"blue_location","Кащей")
	end
end
function remove_kashei()
	local obj = alife():object("kashei")
	if obj then
		level.map_remove_object_spot(obj.id,"blue_location")
	end
end

function reregistr_kashei()
	local obj = alife():object("kashei")
	if obj then
		local params=amk.read_stalker_params(obj)
		params.custom="[logic]\ncfg = scripts\\new\\nebo\\kashei_new.ltx"
		params.sid=14100
		amk.write_stalker_params(params,obj)  
	end
end

function friendactornebo(community1, community2)
	relation_registry.set_community_goodwill ("nebo", "actor", 400)
	sol_utils.minimapSpotReset()
end

function kot_krovosos()
	local position = db.actor:position()
	local sim = alife()
	position.x = position.x + 25
	sim:create("bloodsucker_strong",position, db.actor:level_vertex_id(), db.actor:game_vertex_id())
	sim:create("burer_strong",position, db.actor:level_vertex_id(), db.actor:game_vertex_id())
end

function set_televizor()
	local sim = alife()
	local tbl_targ = {"mar_neutral2","boloto_sniper1","mar_flesh1","mar_bibliotekar","marsh_zombi_hutor"}
	for i = 1, #tbl_targ do
		local obj = sim:object(tbl_targ[i])
		if obj then
			amk.add_spot_on_map(obj.id,"crlc_big","Предполагаемое местонахождение монолитовцев №"..i)
		end
	end
end

function set_kot()
	local obj = alife():object("kot")
	if obj then
		amk.add_spot_on_map(obj.id,"crlc_big","Кот")
	end
end
function remove_kot()
	local obj = alife():object("kot")
	if obj then
		level.map_remove_object_spot(obj.id,"crlc_big")
	end
end

function set_giant()
	local obj = alife():object("gigant_red_strong1")
	if obj then
		amk.add_spot_on_map(obj.id,"crlc_big","УНИКАЛЬНЫЙ ПСЕВДОГИГАНТ")
	end
end
function remove_giant()
	local obj = alife():object("gigant_red_strong1")
	if obj then
		level.map_remove_object_spot(obj.id,"crlc_big")
	end
end

function luis_killself()
 local snd_obj
 if kill_npc_by_name("brat_luis") then
  snd_obj = xr_sound.get_safe_sound_object([[weapons\hpsa\hpsa_shoot]])
  snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)    
 end
end

function francuz_killself()
 local snd_obj
 if kill_npc_by_name("francuz") then
  snd_obj = xr_sound.get_safe_sound_object([[weapons\svu_new\svu_shoot]])
  snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector(), 1.0)    
 end
end

function spawn_glushitel()
local obj = alife():create("glushitel",vector():set(-6.2885980606079,13.082293510437,195.33584594727),21733,3010)
end

function drop_actor(obj)
	local actor = db.actor
   if obj:section() == "glushitel" and actor:has_info("borman_glushitel_restr") then
      db.actor:give_info_portion("borman_glushitel_have")
   end 
end

function start(first_speaker, second_speaker)
	local actor = db.actor
	local trader
	if actor and actor:id() == first_speaker:id() then
		actor = first_speaker
		trader = second_speaker
	else
		actor = second_speaker
		trader = first_speaker
	end
	dialogs.relocate_item_section(trader, "glushitel", "out")	
	local gtime = amk.game_minutes()
	amk.save_variable("glushitel_reload", gtime + 300)
	clear_glushitel(actor)
end

function is_reload_ready(first_speaker, second_speaker)
	local gtime = amk.game_minutes()
	local ftime = amk.load_variable("glushitel_reload", 0)
	if gtime >= ftime then
		return true
	else
		return false
	end
end

function is_reload_not_ready(first_speaker, second_speaker)
	local gtime = amk.game_minutes()
	local ftime = amk.load_variable("glushitel_reload", 0)
	if gtime <= ftime then
		return true
	else
		return false
	end
end

function clear_glushitel(person)
	if person and person:object("glushitel") then
		alife():release(alife():object(person:object("glushitel"):id()), true)
	end
end

function clear_reload(first_speaker, second_speaker)
	amk.del_variable("glushitel_reload")
end

function start_kalmyak(first_speaker, second_speaker)
	local gtime = amk.game_minutes()
	amk.save_variable("kalmyak_lekar", gtime + math.random(11, 12) * 60)
end

function is_lekar_ready(first_speaker, second_speaker)
	local gtime = amk.game_minutes()
	local ftime = amk.load_variable("kalmyak_lekar", 0)
	if gtime >= ftime then
		return true
	else
		return false
	end
end

function is_lekar_not_ready(first_speaker, second_speaker)
	local gtime = amk.game_minutes()
	local ftime = amk.load_variable("kalmyak_lekar", 0)
	if gtime <= ftime then
		return true
	else
		return false
	end
end


function clear_lekar(first_speaker, second_speaker)
	amk.del_variable("kalmyak_lekar")
end

function kot_info() 
	local rnd = math.random
	local ln = level.name()
	local actor = db.actor
    if (has_alife_info("kot_kalmyak_lekar_done") or has_alife_info("kot_holod_lekar_done")) and not has_alife_info("kot_lekar_done")	then
		actor:give_info_portion("kot_lekar_done")
	end
    if not has_alife_info("kot_find_rabi_spawn_rabi") then
		if ln == "l11_pripyat" and has_alife_info("kot_find_rabi_scromnyi") then
			actor:give_info_portion("kot_find_rabi_spawn_rabi")
		end
	end
    if has_alife_info("black_doctor_finish_dialog") and not has_alife_info("black_doctor_delete") then
		actor:give_info_portion("black_doctor_delete")
	end
end

function drink_vodka()
	db.actor:eat(db.actor:object("vodka"))
end

function rabi_mad()
-- local npc,obj
	local level_object_by_id = level.object_by_id
	local npc
	for i=0,65534 do 
        npc = level_object_by_id(i)
        if npc and npc:alive() and npc:name() == "rabi" then 
            -- obj = alife():object(npc:id())
			sol_utils.setCharacterCommunity(i, "zombied")
			break
        end
    end
end

function spawn_prohod_lim()
    if not db.actor:has_info("info_spawn_lim_teleport") then 
		local se_obj = alife():create("lim_zone_teleport2",vector():set(61.7455,3.3956,329.9637),55647,3023)
		xr_logic.pstor_store(db.actor, "lim_zone_teleport2", se_obj.id)
		db.actor:give_info_portion("info_spawn_lim_teleport")
	end
end

function del_lim()
    if not db.actor:has_info("info_del_lim_teleport") then 
		local obj_id = xr_logic.pstor_retrieve(db.actor, "lim_zone_teleport2", -1)
		local se_obj = alife():object(obj_id)
        if se_obj then
          alife():release(se_obj, true)
        end	
		db.actor:give_info_portion("info_del_lim_teleport")
	end
end 

function kurier_dead()
local npc,obj
	for i=0,65534 do 
        npc = level.object_by_id(i)
        if npc and npc:name() == "nebo_kurier" then 
            obj = alife():object(npc:id())
        npc:kill(npc)
        end
    end
end

function kurier_health(obj)
	if db.actor and db.actor.health and db.actor.health < 1 then db.actor.health = db.actor.health + 0.6 end
end 

function actor_sleep_in_do()
sleep_manager.main(5+amk.load_variable("gg_need_sleep_nrg",0))
end

function eat_aptec()
	db.actor:eat(db.actor:object("medkit_scientic"))
end

function eat_antirad()
	db.actor:eat(db.actor:object("antirad"))
end

function doctor_dal()
new_dialog.create_items(db.actor,"medkit_scientic",1)
new_dialog.create_items(db.actor,"antirad",1)
end

function spawn_prohod_hos()
	local actor = db.actor
	if not actor:has_info("info_spawn_hos_teleport") then
		local sim = alife()
		local v = vector()
		local actor = db.actor    
		local se_obj = sim:create("hos_zone_teleport2",v:set(-104.113,34.25,615.65),127,3028)
		xr_logic.pstor_store(actor, "hos_zone_teleport2", se_obj.id)
		local se_obj = sim:create("hos_zone_teleport3",v:set(-92.780,33.493,719.939),1801,3034)
		xr_logic.pstor_store(actor, "hos_zone_teleport3", se_obj.id)
		actor:give_info_portion("info_spawn_hos_teleport")
	end
end


function delete_black_doctor()
	amk.release("black_doctor")
end	

function test_kolmogor()
end 

function forest_info() 
	local actor = db.actor
	if level.name()=="red_forest" and not has_alife_info("actor_in_forest")	then
		actor:give_info_portion("actor_in_forest")
	end
 	
end
--------------------------------------------------------ГРИБЫ---------------------------------------------------------------
local points={
{position={x=-284.4497,y=-18.2044,z=193.8524},gv=1789,lv=56319}, ---склады
{position={x=-355.6864,y=-3.100588,z=151.18237},gv=1793,lv=4240},  ---склады
{position={x=-269.84619,y=-11.2427,z=-71.7646},gv=10,lv=3200},  -- кордон
{position={x=-201.4213,y=-7.3733,z=-45.88},gv=68,lv=51172},  -- кордон
{position={x=-174.16,y=-3.36,z=-13.652},gv=69,lv=76187},  -- кордон
{position={x=-100.404,y=3.5878,z=77.947},gv=81,lv=160506},  -- кордон
{position={x=-52.189,y=4.272,z=250.807},gv=173,lv=227393},  -- кордон
{position={x=32.6452,y=1.899,z=383.063},gv=173,lv=227393},  -- кордон
{position={x=465.1087,y=1.222,z=-178.309},gv=3554,lv=451363},  -- marsh
{position={x=399.41339,y=0.3934,z=-169.761},gv=3547,lv=402755},  -- marsh
{position={x=342.558,y=8.3023,z=-108.475},gv=3533,lv=357939},  -- marsh
{position={x=272.111,y=0.548,z=-43.373},gv=3526,lv=310746},  -- marsh
{position={x=291.1808,y=0.548,z=36.855},gv=3527,lv=325573},  -- marsh
{position={x=367.14099,y=1.8678,z=161.486},gv=3539,lv=376678},  -- marsh
{position={x=387.748,y=3.5888,z=287.368},gv=3540,lv=393779},  -- marsh
{position={x=297.117,y=1.696,z=288.828},gv=3529,lv=329916},  -- marsh
{position={x=205.688,y=0.727,z=285.857},gv=3499,lv=262506},  -- marsh
{position={x=173.0422,y=1.435,z=355.277},gv=3491,lv=238394},  -- marsh
{position={x=214.362,y=0.6504,z=412.3115},gv=3488,lv=268283},  -- marsh
{position={x=217.9902,y=7.394,z=516.679},gv=3485,lv=270887},  -- marsh
{position={x=142.997,y=0.535,z=-248.0656},gv=684,lv=374191},  -- agroprom
{position={x=70.2182,y=-0.972,z=-234.066},gv=433,lv=305517},  -- agroprom
{position={x=63.0578,y=-1.14418,z=-149.503},gv=641,lv=299132},  -- agroprom
{position={x=-74.09,y=0.466,z=58.15},gv=528,lv=166791},  -- agroprom
{position={x=-29.9080,y=2.2372,z=103.523},gv=588,lv=210656},  -- agroprom
{position={x=12.6909,y=2.3448,z=92.3616},gv=476,lv=252867},  -- agroprom
{position={x=81.1135,y=16.0997,z=132.682},gv=508,lv=316629},  -- agroprom
{position={x=106.297,y=13.690,z=125.696},gv=508,lv=340894},  -- agroprom
{position={x=123.6996,y=10.369,z=165.9576},gv=504,lv=357641},  -- agroprom
{position={x=85.8348,y=10.5479,z=188.9713},gv=686,lv=321367},  -- agroprom
{position={x=319.6008,y=-47.9699,z=-195.063},gv=2082,lv=76027},  -- radar
{position={x=316.0666,y=-48.0291,z=-133.312},gv=2092,lv=74170},  -- radar
{position={x=307.758,y=-50.2595,z=-245.0376},gv=2078,lv=69567},  -- radar
{position={x=308.800,y=-49.135,z=-315.755},gv=2073,lv=69851},  -- radar
{position={x=372.8744,y=-51.6907,z=-344.82},gv=2068,lv=105583},  -- radar
{position={x=419.1445,y=-49.5586,z=-310.8674},gv=2066,lv=133749},  -- radar
{position={x=352.3292,y=-47.796,z=-115.3638},gv=2093,lv=94080},  -- radar
{position={x=395.896,y=-52.4274,z=-92.122},gv=2036,lv=122268},  -- radar
{position={x=440.01821,y=-49.07274,z=-55.515},gv=2038,lv=143343},  -- radar
{position={x=380.7494,y=-48.7936,z=-231.103},gv=2102,lv=111292},  -- radar
{position={x=422.2033,y=-55.075,z=-259.047},gv=2106,lv=135222},  -- radar
{position={x=466.6009,y=-48.3848,z=-219.513},gv=2059,lv=153140},  -- radar
{position={x=487.1975,y=-49.9339,z=-185.659},gv=2056,lv=160751},  -- radar
{position={x=109.0610,y=-0.6083,z=23.1811},gv=909,lv=305618},  -- darkvalley
{position={x=161.0832,y=6.02887,z=-9.5908},gv=916,lv=361563},  -- darkvalley
{position={x=177.67697,y=0.0723,z=-80.587},gv=919,lv=378637},  -- darkvalley
{position={x=140.8797,y=0.14625,z=-210.068},gv=927,lv=338700},  -- darkvalley
{position={x=174.1159,y=8.4689,z=-420.6929},gv=941,lv=374683},  -- darkvalley
{position={x=156.46878,y=4.2590,z=-467.606},gv=941,lv=356378},  -- darkvalley
{position={x=93.6686,y=1.662,z=-469.5579},gv=949,lv=288081},  -- darkvalley
{position={x=18.3328,y=1.2652,z=-453.902},gv=952,lv=195541},  -- darkvalley
{position={x=-76.9337,y=-0.73359,z=-395.521},gv=839,lv=83950},  -- darkvalley
{position={x=-129.5605,y=0.86102,z=-344.974},gv=845,lv=28054},  -- darkvalley
{position={x=-131.9178,y=-0.8644,z=-276.884},gv=848,lv=26173},  -- darkvalley
{position={x=203.9575,y=4.3727,z=203.835},gv=2885,lv=351940},  -- puzir
{position={x=182.1907,y=14.3156,z=168.909},gv=2885,lv=335133},  -- puzir
{position={x=106.863,y=4.8457,z=141.5648},gv=2885,lv=274853},  -- puzir
{position={x=60.0144,y=-0.001477,z=108.286},gv=2885,lv=238003},  -- puzir
{position={x=46.0673,y=-0.0032,z=57.7905},gv=2885,lv=226374},  -- puzir
{position={x=-9.9488,y=11.51488,z=-12.7767},gv=2882,lv=180062},  -- puzir
{position={x=54.212,y=8.6488,z=-83.8907},gv=2884,lv=232601},  -- puzir
{position={x=99.8832,y=0.12282,z=-94.3717},gv=2884,lv=269168},  -- puzir
{position={x=102.5485,y=-0.00115,z=-136.3648},gv=2884,lv=270778},  -- puzir
{position={x=-310.1566,y=-8.9571,z=30.3318},gv=2889,lv=338006},  -- aver
{position={x=-249.7383,y=-27.5183,z=127.1921},gv=2893,lv=441876},  -- aver
{position={x=-254.2902,y=11.043003,z=-3.8713},gv=2893,lv=434616},  -- aver
{position={x=-165.4225,y=26.00623,z=6.20755},gv=2894,lv=585369},  -- aver
{position={x=-94.820632,y=17.82067,z=39.2792},gv=2894,lv=708197},  -- aver
{position={x=4.8559,y=-45.3861,z=111.9942},gv=2895,lv=873123},  -- aver
{position={x=43.3978,y=-39.5448,z=166.2731},gv=2895,lv=943483},  -- aver
{position={x=109.7717,y=-40.9248,z=260.0759},gv=2899,lv=1062136},  -- aver
{position={x=217.1144,y=1.8175,z=186.544},gv=2901,lv=1250174},  -- aver
{position={x=-27.02234,y=-0.8796,z=-294.626},gv=3274,lv=44437},  -- red_forest
{position={x=17.7548,y=1.2997,z=-98.825},gv=3288,lv=77292},  -- red_forest
{position={x=-4.83979,y=0.2346,z=-155.3056},gv=3282,lv=64796},  -- red_forest
{position={x=7.52476,y=-2.52619,z=-265.6032},gv=3291,lv=71635},  -- red_forest
{position={x=100.37268,y=-1.5567,z=-290.506},gv=3300,lv=101983},  -- red_forest
{position={x=177.61671,y=-1.304368,z=-290.01339},gv=3314,lv=118739},  -- red_forest
{position={x=179.43177,y=-1.16113,z=-46.8759},gv=3317,lv=119698},  -- red_forest
{position={x=193.84136,y=-4.73345,z=10.9854},gv=3317,lv=126615},  -- red_forest
{position={x=215.8037,y=1.2874,z=102.9057},gv=3319,lv=137614},  -- red_forest
{position={x=194.8108,y=-1.7354,z=62.4528},gv=3318,lv=127327}  -- red_forest
}

function grib_respawn()
local timeh =level.get_time_hours()
local times =level.get_time_minutes()
    if (timeh == 22 and times == 1)  then
        if db.actor:dont_has_info("info_respawn_grib") then
		   del_mushroom()
           spawn_grib()
		   db.actor:give_info_portion("info_respawn_grib")
		end
    end
    if (timeh == 23 and times == 1) then
        db.actor:disable_info_portion("info_respawn_grib")
    end
end	

function spawn_grib()
	local rnd = math.random
	local sim = alife()
	local v = vector()
	for i = 1,28,1 do
	    local a = points[rnd(#points)]
		sim:create("mushroom", v:set(a.position.x, a.position.y, a.position.z), a.lv, a.gv)
end

end

function del_mushroom()
	local sim = alife()
	local actorpos = db.actor:position()
	local string_find = string.find
    for a=1,65534 do
    local obj=sim:object(a)
--	local obj = level.object_by_id(a)
	    if obj then
	        if string_find(obj:section_name(),"mushroom") then
				local posobj = obj.position			
			    if posobj:distance_to(actorpos) > 30 then
			        sim:release(obj,true)
				end	
			end   
	    end
	end
end
--------------------------------------------------------ГРИБЫ---------------------------------------------------------------

function set_green()
	local sim = alife()
	local obj = sim:object("green_forest")
	if obj then
        amk.add_spot_on_map(obj.id,"crlc_big","Охотники") 
    end
end

function remove_green()
	local sim = alife()
	local obj = sim:object("green_forest")
	if obj then
        level.map_remove_object_spot(obj.id,"crlc_big")
    end
end

function spawn_green()
	alife():create("green_ruk",vector():set(228.335338,-7.298178,67.8218),143611,3319)
end

function clear_actor(npc)
 local sim = alife()
 local actor = db.actor
 local obj
 for i=0, actor:object_count()-1 do
  obj = actor:object(i)
  if obj then
   item_clsid = obj:clsid()
   if ( isWeapon(obj) or 
        (item_clsid == clsid.equ_exo or item_clsid == clsid.equ_military or item_clsid == clsid.equ_scientific or item_clsid == clsid.equ_stalker or item_clsid == clsid.equ_stalker_s) or
        not protected_items.doNotTouchItemEquipment(obj) ) then 
    sim:release(sim:object(obj:id()), true) 
   end
  end
 end
 arhara_dialog.release_actor_money()
-- news_manager.send_tip(db.actor,"%c[255,160,160,160]".."СТРЕЛОК:".."\\n".."%c[255,255,128,128]Что за ... Ни шмоток, ни денег, ни ствола ... Попал ты, дятел...".."\n",nil,nil,60000)  
 sol_utils.send_tip( "%c[255,160,160,160]".."СТРЕЛОК:".."\\n".."%c[255,255,128,128]Что за ... Ни шмоток, ни денег, ни ствола ... Попал ты, дятел...", nil, nil, 60000)
 sol_sound.sms("characters_voice\\ozvuchka\\release_actor_money")
 friendactorstalker(community1, community2)
end

function friendactorstalker(community1, community2)
relation_registry.set_community_goodwill ("stalker", "actor", 400)
relation_registry.set_community_goodwill ("green", "actor", 100)
sol_utils.minimapSpotReset()
end

function actor_has_money_10000()
  return db.actor:money()>=10000
end

function give_money_10000(t1,t2)
  local npc=t1
  if npc:id()==db.actor:id() then
    npc=t2
  end
  dialogs.relocate_money(npc,10000,"out")
end

function speech_test()
--news_manager.send_tip(db.actor,"ЖОПАААААААААААААААААААААААААААААААААААА",nil,nil,60000)  
--db.actor:give_info_portion("mitya_dead_sms_sidor")
end

function kot_update()
	if not has_alife_info("bkot_spawn") then
		if level.name()=="l05_bar" and has_alife_info("kot_need_next_done") then
			del_kot_marsh()
		end
	end
end

function del_kot_marsh()
local se_obj = alife():object("kot")
  if se_obj then
    alife():release(se_obj, true)
	db.actor:give_info_portion("bkot_spawn")
  end
end	

function spawn_zombi_forest() 
	local sim = alife()
	local v = vector()
    if not db.actor:has_info("info_contr_spawn") then  
		sim:create("zombie_beee",v:set(-139.66778564453,-6.2611632347107,-57.55558013916),7320,3240)
		sim:create("zombie_beee",v:set(-139.66778564453,-6.2611632347107,-57.55558013916),7320,3240)
		sim:create("zombie_beee",v:set(-139.66778564453,-6.2611632347107,-57.55558013916),7320,3240)
		sim:create("zombie_beee",v:set(-166.70251464844,2.2021112442017,-43.638122558594),4559,3240)
		sim:create("zombie_beee",v:set(-166.70251464844,2.2021112442017,-43.638122558594),4559,3240)
		sim:create("zombie_beee",v:set(-166.70251464844,2.2021112442017,-43.638122558594),4559,3240)
		sim:create("zombie_beee",v:set(-150.7121887207,2.2457160949707,-32.752670288086),6685,3240)
		sim:create("zombie_beee",v:set(-150.7121887207,2.2457160949707,-32.752670288086),6685,3240)
		sim:create("zombie_beee",v:set(-150.7121887207,2.2457160949707,-32.752670288086),6685,3240)
    db.actor:give_info_portion("info_contr_spawn")
   end	
end

function forest_update()
	local ln = level.name()
	local actor = db.actor
	if ln == "red_forest" and has_alife_info("contr_forest1_dead") and has_alife_info("contr_forest2_dead")	then
		actor:give_info_portion("contr_forest_deads")
	end	
	if ln == "red_forest" and has_alife_info("denis_wound_start") and has_alife_info("forest_wound_dead") and 
	   not has_alife_info("denis_wound_next") then
		actor:give_info_portion("denis_wound_fail")
	end	
end

function spawn_denis() 
	local sim = alife()
	local v = vector()
	sim:create("killer_denis1",v:set(-154.03199768066,2.179135799408,-29.984512329102),6074,3240)
	sim:create("killer_denis2",v:set(-168.93768310547,2.1791498661041,-25.87652015686),4320,3240)
	sim:create("killer_denis3",v:set(-153.88787841797,2.1781146526337,-38.099498748779),6064,3240)
	sim:create("killer_denis4",v:set(-150.86233520508,2.3751785755157,-45.025329589844),6540,3240)
	sim:create("killer_denis5",v:set(-157.27326965332,2.2941052913666,-50.785617828369),5652,3240)
	sim:create("killer_denis6",v:set(-115.58462524414,2.3102631568909,-55.957679748535),9854,3240)
	sim:create("killer_denis7",v:set(-112.0415725708,2.3187811374664,-54.043090820313),10286,3240)
	sim:create("killer_denis8",v:set(-103.67635345459,2.3016946315765,-56.758888244629),11667,3250)
	sim:create("killer_denis9",v:set(-164.65612792969,2.2453947067261,-42.774707794189),4821,3240)
end

function set_tunel()
	local sim = alife()
	local obj = alife():object("contr_forest_restr")
	if obj then
		amk.add_spot_on_map(obj.id,"crlc_big","Заброшенная Шахта")
	end
end

function remove_tunel()
	local sim = alife()
	local obj = alife():object("contr_forest_restr")
	if obj then
		level.map_remove_object_spot(obj.id,"crlc_big")
	end
end

function spawn_ag_restr()
local se_obj = alife():create("space_restrictor",vector():set(-163.7038269043,0.33191874623299,-299.45358276367),73168,447)
local custom = "[logic]\ncfg = scripts\\new\\nebo\\ag_restr.ltx"
rewrite_restrictor(se_obj, custom, 60.0)
end